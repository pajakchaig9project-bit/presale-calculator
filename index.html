<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Presale Calculator – วิลล์ฟอร์ยู</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Inter, sans-serif; background-color: #F0F4F8; }
    .chart-container { position: relative; width: 100%; max-width: 600px; height: 300px; }
  </style>
</head>
<body class="text-gray-800 p-6">

  <header class="mb-8 text-center">
    <h1 class="text-4xl font-bold text-[#005F73]">Presale Calculator</h1>
    <p class="text-gray-600">ปรับค่าต้นทุนและพารามิเตอร์ แล้วดูรายได้ทรัพยากรแบบเรียลไทม์</p>
  </header>

  <section id="presale-calculator" class="bg-white p-6 rounded-lg shadow-lg">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Input Form -->
      <div class="space-y-4">
        <h2 class="text-2xl font-semibold text-[#0A9396]">Input Parameters</h2>

        <div>
          <label class="block mb-1">C_push (฿/push)</label>
          <input id="inp-cpush" type="number" step="0.0001" class="w-full p-2 border rounded" value="0.0008"/>
        </div>

        <div>
          <label class="block mb-1">C_event (฿/event)</label>
          <input id="inp-cevent" type="number" step="0.001" class="w-full p-2 border rounded" value="0.004"/>
        </div>

        <div>
          <label class="block mb-1">C_gps (฿/sample)</label>
          <input id="inp-cgps" type="number" step="0.00001" class="w-full p-2 border rounded" value="0.00006"/>
        </div>

        <div>
          <label class="block mb-1">C_presence (฿/heartbeat)</label>
          <input id="inp-cpresence" type="number" step="0.0001" class="w-full p-2 border rounded" value="0.0005"/>
        </div>

        <div>
          <label class="block mb-1">C_mb (฿/MB)</label>
          <input id="inp-cmb" type="number" step="0.01" class="w-full p-2 border rounded" value="0.40"/>
        </div>

        <div>
          <label class="block mb-1">FixedPerTrip (฿)</label>
          <input id="inp-fixed" type="number" step="0.1" class="w-full p-2 border rounded" value="0.80"/>
        </div>

        <div>
          <label class="block mb-1">D_online (drivers)</label>
          <input id="inp-donline" type="number" class="w-full p-2 border rounded" value="8"/>
        </div>

        <div>
          <label class="block mb-1">DataEvents (events/trip)</label>
          <input id="inp-devents" type="number" class="w-full p-2 border rounded" value="20"/>
        </div>

        <div>
          <label class="block mb-1">GPSsamples (samples/trip)</label>
          <input id="inp-gpsamples" type="number" class="w-full p-2 border rounded" value="180"/>
        </div>

        <div>
          <label class="block mb-1">Presence (heartbeats/trip)</label>
          <input id="inp-presence" type="number" class="w-full p-2 border rounded" value="8"/>
        </div>

        <div>
          <label class="block mb-1">StorageMB (MB/trip)</label>
          <input id="inp-storage" type="number" step="0.1" class="w-full p-2 border rounded" value="0.6"/>
        </div>

        <div>
          <label class="block mb-1">Margin (%)</label>
          <input id="inp-margin" type="number" class="w-full p-2 border rounded" value="40"/>
        </div>

        <div>
          <label class="block mb-1">Trip Duration (min)</label>
          <input id="inp-duration" type="number" class="w-full p-2 border rounded" value="10"/>
        </div>

        <button id="btn-calc" class="mt-4 w-full bg-[#EE9B00] hover:bg-[#CA6702] text-white font-bold py-2 rounded">
          Calculate
        </button>
      </div>

      <!-- Results & Chart -->
      <div>
        <h2 class="text-2xl font-semibold text-[#0A9396] mb-4">Results</h2>
        <div class="space-y-2 text-gray-700 mb-6">
          <p>TotalCostPerTrip: <span id="out-cost">–</span> ฿</p>
          <p>SellTrip: <span id="out-sellTrip">–</span> ฿</p>
          <p>Revenue/Min: <span id="out-revMin">–</span> ฿</p>
          <p>Revenue/Sec: <span id="out-revSec">–</span> ฿</p>
        </div>
        <div class="chart-container">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('revenueChart').getContext('2d');
      const revenueChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['SellTrip'],
          datasets: [{
            label: '฿ per trip',
            data: [0],
            backgroundColor: '#0A9396'
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Baht' } }
          }
        }
      });

      document.getElementById('btn-calc').addEventListener('click', () => {
        // read inputs
        const C_push       = +document.getElementById('inp-cpush').value;
        const C_event      = +document.getElementById('inp-cevent').value;
        const C_gps        = +document.getElementById('inp-cgps').value;
        const C_presence   = +document.getElementById('inp-cpresence').value;
        const C_mb         = +document.getElementById('inp-cmb').value;
        const FixedPerTrip = +document.getElementById('inp-fixed').value;
        const D_online     = +document.getElementById('inp-donline').value;
        const DataEvents   = +document.getElementById('inp-devents').value;
        const GPSsamples   = +document.getElementById('inp-gpsamples').value;
        const Presence     = +document.getElementById('inp-presence').value;
        const StorageMB    = +document.getElementById('inp-storage').value;
        const margin       = +document.getElementById('inp-margin').value / 100;
        const tripDuration = +document.getElementById('inp-duration').value;

        // cost formula
        const TotalCostPerTrip =
          (D_online * C_push) +
          (DataEvents * C_event) +
          (GPSsamples * C_gps) +
          (Presence * C_presence) +
          (StorageMB * C_mb) +
          FixedPerTrip +
          (1 * C_push); // rider push

        const SellTrip = TotalCostPerTrip / (1 - margin);
        const RevMin   = SellTrip / tripDuration;
        const RevSec   = SellTrip / (tripDuration * 60);

        // update UI
        document.getElementById('out-cost').innerText     = TotalCostPerTrip.toFixed(3);
        document.getElementById('out-sellTrip').innerText = SellTrip.toFixed(3);
        document.getElementById('out-revMin').innerText   = RevMin.toFixed(3);
        document.getElementById('out-revSec').innerText   = RevSec.toFixed(5);

        // update chart
        revenueChart.data.datasets[0].data = [SellTrip];
        revenueChart.update();
      });
    });
  </script>

</body>
</html>
